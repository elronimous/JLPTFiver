<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JLPT Grammar Daily Scheduler</title>
  <link rel="stylesheet" href="css/app.css" />
</head>
<body>
  <div class="page">
    <header class="header-bar">
      <div class="header-top">
        <div class="header-title">
          <div class="header-title-main">Daily JLPT Grammar</div>
          <div class="header-title-pill">‰∫î„Å§„Åß„ÇÇ„ÇÑ„Çç„ÅÜÔΩûÔºÅ</div>
        </div>

        <div class="date-controls">
          <button id="prevDayBtn" class="chip-btn">‚óÄ Prev</button>
          <button id="todayBtn" class="chip-btn primary">Today</button>
          <button id="nextDayBtn" class="chip-btn">Next ‚ñ∂</button>

          <input type="date" id="viewDate" class="hidden-date-input" />
          <button id="openCalendarBtn" class="chip-btn icon-only" title="Select date">üìÖ</button>
          <button id="openSettingsBtn" class="settings-gear-btn" title="Settings">‚öô</button>
        </div>
      </div>

      <div class="level-filter-row">
        <button class="level-filter-btn ALL active" data-level="ALL">All</button>
        <button class="level-filter-btn N5 active" data-level="N5">N5</button>
        <button class="level-filter-btn N4 active" data-level="N4">N4</button>
        <button class="level-filter-btn N3 active" data-level="N3">N3</button>
        <button class="level-filter-btn N2 active" data-level="N2">N2</button>
        <button class="level-filter-btn N1 active" data-level="N1">N1</button>

        <button id="openViewAllBtn" class="chip-btn">View All</button>
        <button id="openCramBtn" class="chip-btn">Cram</button>
      </div>
    </header>

    <main class="panel">
      <div class="meta-row">
        <div><span class="meta-label">View</span> <span class="meta-value" id="infoDate"></span></div>
        <div><span class="meta-label">Per level</span> <span class="meta-value">5 items</span></div>
      </div>

      <div id="output"></div>

      <!-- Study Log (Heatmap) -->
      <div id="heatmapPanel" class="heatmap-panel">
        <div class="hm-header">
          <div style="display:flex;align-items:center;gap:.55rem;flex-wrap:wrap">
            <div class="hm-title">Study Log</div>
            <button id="openHeatmapSettingsBtn" class="settings-gear-btn" title="Study Log settings" style="padding:.18rem .55rem;font-size:.9rem">‚öô</button>
          </div>
        </div>

        <div class="hm-grid-wrap">
          <div id="hmMonthLabels" class="hm-month-labels"></div>
          <div id="hmGrid" class="hm-grid" aria-label="Study log heatmap"></div>
        </div>

        <div class="hm-year-controls">
          <button id="hmPrevYearBtn" class="chip-btn icon-only" title="Previous year">‚Äπ</button>
          <div id="hmYearLabel" class="hm-year-label">2025</div>
          <button id="hmNextYearBtn" class="chip-btn icon-only" title="Next year">‚Ä∫</button>
        </div>

        <div id="hmStats" class="hm-stats">
          <div id="hmFirstVisitWrap">
            <span class="hm-stat-label">First Visit</span>
            <span class="hm-stat-value" id="hmFirstVisitVal">‚Äî</span>
          </div>
          <div id="hmStreakWrap">
            <span class="hm-stat-label">Streak</span>
            <span class="hm-stat-value" id="hmStreakVal">0</span>
          </div>
          <div id="hmTotalWrap">
            <span class="hm-stat-label">Total</span>
            <span class="hm-stat-value" id="hmTotalVal">0</span>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Tooltip -->
  <div id="appTooltip" class="hm-tooltip" role="tooltip"></div>

  <!-- View All modal -->
  <div id="viewAllModal" class="modal-backdrop" hidden>
    <div class="modal modal-wide">
      <div class="modal-header">
        <div class="viewall-title-row">
          <div class="modal-title">All Grammar Points</div>
          <div class="viewall-filters">
            <span class="viewall-filter-label">Show:</span>
            <button id="viewAllFilterSeen" class="viewall-starfilter-btn" title="Starred only" aria-label="Starred only">‚òÖ</button>
            <button id="viewAllFilterUnseen" class="viewall-starfilter-btn" title="Unstarred only" aria-label="Unstarred only">‚òÜ</button>
          </div>
        </div>
        <button id="closeViewAllBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>
      <input id="viewAllSearch" class="viewall-search" placeholder="Search‚Ä¶ (filters the list)" />
      <div id="viewAllContent"></div>
    </div>
  </div>

  <!-- Settings modal -->
  <div id="settingsModalBackdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Settings & Data</div>
        <button id="closeSettingsBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="modal-hint">
          Data is stored locally in this browser. Export periodically if you care about it.
        </div>

        <div class="settings-section-title">Study Log</div>
        <label class="settings-row" for="toggleHeatmapVisible">
          <input id="toggleHeatmapVisible" type="checkbox" />
          <span>Show Study Log</span>
        </label>

        <div class="settings-section-title">Notes</div>
        <label class="settings-row" for="toggleHideEnglishNotes">
          <input id="toggleHideEnglishNotes" type="checkbox" />
          <span>Hide English by default</span>
        </label>

        <div class="settings-section-title">Scoring</div>
        <label class="settings-row" for="toggleEmojiScores">
          <input id="toggleEmojiScores" type="checkbox" />
          <span>Use Emoji Score system</span>
        </label>

        <div class="settings-section-title">Grammar Order</div>
        <label class="settings-row" for="toggleProgressiveMode">
          <input id="toggleProgressiveMode" type="checkbox" />
          <span>Progressive grammar instead of Random?</span>
        </label>

        <div id="progressiveDatesWrap" class="progressive-wrap" hidden>
          <div class="modal-hint" style="margin:.4rem 0 .2rem">
            Set the start date for each level. From that date onward, that level will show grammar in CSV order.
          </div>
          <div id="progressiveDatesGrid" class="progressive-grid"></div>
        </div>

        <div class="settings-section-title">Export / Import</div>
        <div class="modal-actions">
          <button id="exportDataBtn" class="modal-btn primary">‚¨á Export‚Ä¶</button>
          <button id="importDataBtn" class="modal-btn">‚¨Ü Import‚Ä¶</button>
        </div>

        <div class="settings-section-title">Danger zone</div>
        <div class="modal-actions">
          <button id="deleteAllDataBtn" class="modal-btn danger">üóë Delete all data!</button>
        </div>

        <input type="file" id="importFileInput" accept="application/json" hidden />
      </div>
    </div>
  </div>



  <!-- Export options modal -->
  <div id="exportOptionsModalBackdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Export Options</div>
        <button id="closeExportOptionsBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="modal-hint">
          Choose what to include in your export file. If you're not sure, leave everything ticked.
        </div>

        <div class="data-select-grid">
          <label class="settings-row" for="exSeen"><input id="exSeen" type="checkbox" checked /> <span>Stars / Seen items</span></label>
          <label class="settings-row" for="exNotes"><input id="exNotes" type="checkbox" checked /> <span>Custom sentences (Notes)</span></label>
          <label class="settings-row" for="exScores"><input id="exScores" type="checkbox" checked /> <span>Emoji scores</span></label>
          <label class="settings-row" for="exSettings"><input id="exSettings" type="checkbox" checked /> <span>App settings</span></label>
          <label class="settings-row" for="exHeatmap"><input id="exHeatmap" type="checkbox" checked /> <span>Study Log (heatmap)</span></label>
          <label class="settings-row" for="exUi"><input id="exUi" type="checkbox" checked /> <span>UI (filters + expanded sections)</span></label>
          <label class="settings-row" for="exCramLists"><input id="exCramLists" type="checkbox" checked /> <span>Custom cram lists</span></label>
        </div>

        <div class="modal-actions">
          <button id="exportSelectedBtn" class="modal-btn primary">Export selected</button>
          <button id="exportSelectAllBtn" class="modal-btn">Select all</button>
          <button id="exportSelectNoneBtn" class="modal-btn">Select none</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Import options modal -->
  <div id="importOptionsModalBackdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Import Options</div>
        <button id="closeImportOptionsBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>

      <div class="modal-body">
        <div id="importSummaryHint" class="modal-hint"></div>

        <div class="settings-section-title">Mode</div>
        <div class="data-mode-row">
          <label class="settings-row" for="importModeOverwrite"><input id="importModeOverwrite" name="importMode" type="radio" value="overwrite" checked /> <span>Overwrite</span></label>
          <label class="settings-row" for="importModeMerge"><input id="importModeMerge" name="importMode" type="radio" value="merge" /> <span>Merge (only add missing items)</span></label>
        </div>

        <div class="settings-section-title">What to import</div>
        <div class="data-select-grid">
          <label class="settings-row" for="imSeen"><input id="imSeen" type="checkbox" /> <span>Stars / Seen items</span></label>
          <label class="settings-row" for="imNotes"><input id="imNotes" type="checkbox" /> <span>Custom sentences (Notes)</span></label>
          <label class="settings-row" for="imScores"><input id="imScores" type="checkbox" /> <span>Emoji scores</span></label>
          <label class="settings-row" for="imSettings"><input id="imSettings" type="checkbox" /> <span>App settings</span></label>
          <label class="settings-row" for="imHeatmap"><input id="imHeatmap" type="checkbox" /> <span>Study Log (heatmap)</span></label>
          <label class="settings-row" for="imUi"><input id="imUi" type="checkbox" /> <span>UI (filters + expanded sections)</span></label>
          <label class="settings-row" for="imCramLists"><input id="imCramLists" type="checkbox" /> <span>Custom cram lists</span></label>
        </div>

        <div class="modal-actions">
          <button id="applyImportBtn" class="modal-btn primary">Import selected</button>
          <button id="importSelectAllBtn" class="modal-btn">Select all</button>
          <button id="importSelectNoneBtn" class="modal-btn">Select none</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Delete data modal -->
  <div id="deleteOptionsModalBackdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Delete Data</div>
        <button id="closeDeleteOptionsBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="modal-hint">
          Tick what you want to delete. This affects only this browser on this device.
        </div>

        <div class="data-select-grid">
          <label class="settings-row" for="delSeen"><input id="delSeen" type="checkbox" checked /> <span>Stars / Seen items</span></label>
          <label class="settings-row" for="delNotes"><input id="delNotes" type="checkbox" checked /> <span>Custom sentences (Notes)</span></label>
          <label class="settings-row" for="delScores"><input id="delScores" type="checkbox" checked /> <span>Emoji scores</span></label>
          <label class="settings-row" for="delSettings"><input id="delSettings" type="checkbox" checked /> <span>App settings</span></label>
          <label class="settings-row" for="delHeatmap"><input id="delHeatmap" type="checkbox" checked /> <span>Study Log (heatmap)</span></label>
          <label class="settings-row" for="delUi"><input id="delUi" type="checkbox" checked /> <span>UI (filters + expanded sections)</span></label>
          <label class="settings-row" for="delCramLists"><input id="delCramLists" type="checkbox" checked /> <span>Custom cram lists</span></label>
          <label class="settings-row" for="delCramSession"><input id="delCramSession" type="checkbox" checked /> <span>Saved cram session</span></label>
        </div>

        <div class="modal-actions">
          <button id="deleteSelectedBtn" class="modal-btn danger">üóë Delete selected</button>
          <button id="deleteSelectAllBtn" class="modal-btn">Select all</button>
          <button id="deleteSelectNoneBtn" class="modal-btn">Select none</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Study Log settings modal -->
  <div id="heatmapSettingsModalBackdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Study Log Settings</div>
        <button id="closeHeatmapSettingsBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="settings-section-title">Stats to show</div>
        <label class="settings-row" for="hmShowFirstVisit">
          <input id="hmShowFirstVisit" type="checkbox" />
          <span>First Visit</span>
        </label>
        <label class="settings-row" for="hmShowStreak">
          <input id="hmShowStreak" type="checkbox" />
          <span>Streak</span>
        </label>
        <label class="settings-row" for="hmShowTotal">
          <input id="hmShowTotal" type="checkbox" />
          <span>Total</span>
        </label>

        <div class="settings-section-title">Month labels</div>
        <label class="settings-row" for="hmShowMonthTitles">
          <input id="hmShowMonthTitles" type="checkbox" />
          <span>Show month titles (Jan, Feb, ‚Ä¶)</span>
        </label>

        <div class="settings-section-title">Colour palette</div>
        <div id="hmPaletteOptions" class="hm-palette-options"></div>

        <div class="settings-section-title">Goals</div>
        <div class="modal-hint">
          Emoji tip: Windows <b>Win + .</b> ‚Äî Mac <b>Ctrl + Cmd + Space</b>
        </div>

        <div id="hmGoalsList" class="hm-goals-list"></div>

        <button id="hmAddGoalBtn" class="modal-btn primary" style="margin-top:.6rem">Ôºã Add new goal!</button>

        <div id="hmGoalEditor" class="hm-goal-editor" hidden></div>
      </div>
    </div>
  </div>

  <!-- Notes import modal -->
  <div id="notesImportModalBackdrop" class="modal-backdrop" hidden>
    <div class="modal modal-wide">
      <div class="modal-header">
        <div class="modal-title">Import Sentences</div>
        <button id="closeNotesImportBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="modal-hint">
          Paste lines: odd lines are Japanese, even lines are English.
          Use <b>#text#</b> to highlight (level colour + weight 800).
        </div>
        <textarea id="notesImportTextarea" class="notes-import-textarea" placeholder="JP line 1&#10;EN line 1&#10;JP line 2&#10;EN line 2&#10;..."></textarea>
        <div class="modal-actions">
          <button id="applyNotesImportBtn" class="modal-btn primary">OK</button>
          <button id="cancelNotesImportBtn" class="modal-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CRAM modal -->
  <div id="cramModalBackdrop" class="modal-backdrop" hidden>
    <div class="modal modal-wide">
      <div class="modal-header">
        <div class="modal-title">Cram</div>
        <button id="closeCramBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="cram-controls">
          <input id="cramSearch" class="viewall-search" placeholder="Search grammar / meaning‚Ä¶" />

          <div class="cram-filter-row">
            <div class="cram-filter-group">
              <div class="viewall-filter-label">Levels</div>
              <div id="cramLevelFilters" class="cram-level-filters"></div>
            </div>

            <div class="cram-filter-group">
              <div class="viewall-filter-label">Stars</div>
              <div class="cram-stars">
                <button class="cram-star-btn active" data-star="any">Any</button>
                <button class="cram-star-btn" data-star="starred">Starred</button>
              </div>
            </div>

            <div class="cram-filter-group">
              <div class="viewall-filter-label">Score range</div>
              <div class="cram-score-range">
                <select id="cramScoreMin" class="cram-select"></select>
                <span style="opacity:.7">to</span>
                <select id="cramScoreMax" class="cram-select"></select>
              </div>
            </div>

            <div class="cram-filter-group">
              <div class="viewall-filter-label">Examples per grammar</div>
              <input id="cramItemsPerGrammar" class="cram-select cram-number" type="number" min="1" max="10" step="1" value="5" />
            </div>
          </div>
          <div class="cram-bulk-row">
            <button id="cramSelectTodayBtn" class="modal-btn">Select today's grammar</button>
            <button id="cramDeselectAllBtn" class="modal-btn">Deselect all</button>
          </div>

          <div class="cram-customlists">
            <div class="viewall-filter-label">Custom lists</div>
            <div class="cram-customlists-row">
              <select id="cramCustomListSelect" class="cram-select"></select>
              <button id="cramLoadCustomListBtn" class="modal-btn" type="button" disabled>Load</button>
              <button id="cramAddToCustomListBtn" class="modal-btn" type="button" disabled>Add to list</button>
              <button id="cramDeleteCustomListBtn" class="modal-btn" type="button" disabled>Delete</button>
            </div>
            <div class="cram-customlists-row">
              <input id="cramCustomListName" class="cram-select cram-text" type="text" placeholder="New list name‚Ä¶" />
              <button id="cramSaveNewCustomListBtn" class="modal-btn" type="button" disabled>Save new</button>
            </div>
            <div id="cramCustomListHint" class="modal-hint" style="margin:.1rem 0 0 0">Save your current selection, then load it later from the dropdown.</div>
          </div>




          <div class="cram-footer-row">
            <div class="cram-counts">
              <div id="cramSelectedCount" class="modal-hint" style="margin:0">Selected: 0</div>
              <div id="cramTotalCards" class="modal-hint" style="margin:0">Total cards: 0</div>
              <div id="cramSelectedByLevel" class="modal-hint" style="margin:0">Selected Grammar: N5=0, N4=0, N3=0, N2=0, N1=0</div>
            </div>
            <button id="cramStartBtn" class="modal-btn primary" disabled>Start</button>
          </div>
        </div>

        <div id="cramList" class="cram-list"></div>
      </div>
    </div>
  </div>

  <!-- CRAM resume prompt -->
  <div id="cramResumeBackdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Resume cram?</div>
        <button id="cramResumeCloseBtn" class="modal-close-btn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="modal-hint" style="margin:0 0 .8rem 0">You have a saved cram session. Continue where you left off?</div>
        <div class="modal-actions">
          <button id="cramResumeBtn" class="modal-btn primary" type="button">Continue</button>
          <button id="cramDiscardBtn" class="modal-btn" type="button">Start new</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CRAM session overlay -->
  <div id="cramSessionOverlay" class="cram-session" hidden>
    <div class="cram-session-top">
      <div class="cram-session-stats">
        <div id="cramProgressText" class="cram-session-stat">Remaining 0 / 0</div>
        <div id="cramScoreText" class="cram-session-stat">Wrong 0 ‚Ä¢ Right 0</div>
      </div>
      <div class="cram-session-actions">
        <button id="cramSaveBtn" class="chip-btn primary" type="button">Save progress</button>
        <button id="cramQuitBtn" class="chip-btn" type="button">‚úï Quit</button>
      </div>
    </div>

    <div class="cram-card-wrap">
      <div id="cramCard" class="cram-card" tabindex="0" role="button" aria-label="Flashcard"></div>
      <div class="cram-actions">
        <button id="cramWrongBtn" class="cram-action wrong">WRONG</button>
        <button id="cramRightBtn" class="cram-action right">RIGHT</button>
        <button id="cramNextBtn" class="cram-action next" hidden>NEXT</button>
      </div>
      <div id="cramFlipHint" class="modal-hint" style="text-align:center;margin-top:.6rem">
        Click the card to flip.
      </div>
    </div>
  </div>

  <!-- Fallback grammar data (only used if fetch fails, e.g. file://) -->
  <template id="csvDataFallback">
N5,1,„Å†,da,"To be, Is",https://bunpro.jp/grammar_points/%E3%81%A0
N5,2,„Åß„Åô,desu,"To be, Is",https://bunpro.jp/grammar_points/%E3%81%A7%E3%81%99
N5,3,„ÅØ,wa,As for... (Highlights sentence topic),https://bunpro.jp/grammar_points/%E3%81%AF
N5,4,„ÇÇ,mo,"Also, Too, As well, Even, Either, Neither",https://bunpro.jp/grammar_points/%E3%82%82
N5,5,„Åì„Çå,kore,This,https://bunpro.jp/grammar_points/%E3%81%93%E3%82%8C
N4,1,„Åß„ÇÇ,demo,"Or something, Any... (with question words), No matter (who)",https://bunpro.jp/grammar_points/%E3%81%A7%E3%82%82
N4,2,„ÇÑ„Åô„ÅÑ,yasui,"Easy to, Likely to",https://bunpro.jp/grammar_points/%E3%82%84%E3%81%99%E3%81%84
N4,3,„Å´„Åè„ÅÑ,nikui,"Difficult to, Hard to",https://bunpro.jp/grammar_points/%E3%81%AB%E3%81%8F%E3%81%84
N4,4,„Å†„Çì„Å†„Çì,dandan,"Gradually, Little by little, Step by step",https://bunpro.jp/grammar_points/%E3%81%A0%E3%82%93%E3%81%A0%E3%82%93
N4,5,„Å©„Çì„Å©„Çì,dondon,"Progressively, Rapidly increasing, More and more",https://bunpro.jp/grammar_points/%E3%81%A9%E3%82%93%E3%81%A9%E3%82%93
  </template>

  <script src="js/constants.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/tooltip.js"></script>
  <script src="js/csv.js"></script>
  <script src="js/scores.js"></script>
  <script src="js/notes.js"></script>
  <script src="js/heatmap.js"></script>
  <script src="js/viewall.js"></script>
  <script src="js/daily.js"></script>
  <script src="js/cram.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
